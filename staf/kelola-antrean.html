<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kelola Antrean - Smart Health Center Service</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .queue-control-panel {
      background: linear-gradient(135deg, #00796b 0%, #004d40 100%);
      color: #fff;
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
    }
    .current-patient-card {
      background: #fff;
      color: #333;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    .next-queue {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .next-queue-item {
      background: rgba(255,255,255,0.2);
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .next-queue-item:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-3px);
    }
    .action-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .action-buttons button {
      padding: 1rem;
      font-size: 1rem;
    }
    .poli-selector {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }
    .poli-selector button {
      padding: 0.75rem 1.5rem;
      border: 2px solid #00796b;
      background: #fff;
      color: #00796b;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    .poli-selector button.active {
      background: #00796b;
      color: #fff;
    }
    .status-timeline {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 2rem 0;
      position: relative;
    }
    .status-timeline::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 4px;
      background: #e0e0e0;
      z-index: 0;
    }
    .status-step {
      text-align: center;
      position: relative;
      z-index: 1;
      flex: 1;
    }
    .status-step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #e0e0e0;
      margin: 0 auto 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      transition: all 0.3s ease;
    }
    .status-step.active .status-step-circle {
      background: #00796b;
      box-shadow: 0 0 0 4px rgba(0,121,107,0.2);
    }
    .status-step.completed .status-step-circle {
      background: #4caf50;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo" style="flex-direction: column; align-items: flex-start; gap: 0.25rem;">
        <img src="../img/Smarthealth-Logo.png" alt="Smart Health Logo" style="height: 45px;">
        <p style="font-size: 0.75rem; margin: 0; color: #5f7a95;">Layanan Digital Puskesmas - Portal Staf</p>
      </div>
      <nav>
        <div class="nav-container">
          <div class="nav-breadcrumb">
            <a href="dashboard.html">ğŸ  Dashboard</a>
            <span class="separator">â€º</span>
            <span class="current-page">âš™ï¸ Kelola Antrean</span>
          </div>
          <div class="nav-actions">
            <div class="nav-dropdown">
              <button class="dropdown-toggle">ğŸ“‹ Menu â–¼</button>
              <div class="dropdown-menu">
                <a href="daftar-antrean.html">ğŸ“‹ Daftar Antrean</a>
                <a href="validasi-surat.html">âœ… Validasi Surat</a>
                <a href="hasil-pemeriksaan.html">ğŸ“ Hasil Pemeriksaan</a>
              </div>
            </div>
            <div class="nav-dropdown">
              <button class="dropdown-toggle">ğŸ‘¨â€âš•ï¸ Akun â–¼</button>
              <div class="dropdown-menu">
                <a href="../logout.html" style="color: #d32f2f; font-weight: 700;">ğŸšª Logout</a>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main>
    <div class="page-header">
      <h2>âš™ï¸ Kelola Antrean Pasien</h2>
      <p>Rabu, 27 November 2025 - <span id="currentTime"></span></p>
    </div>

    <!-- Poli Selector -->
    <div class="card">
      <h3>ğŸ¥ Pilih Poli</h3>
      <div class="poli-selector">
        <button class="active" onclick="selectPoli('umum')">Poli Umum</button>
        <button onclick="selectPoli('gigi')">Poli Gigi</button>
        <button onclick="selectPoli('anak')">Poli Anak</button>
        <button onclick="selectPoli('kandungan')">Poli Kandungan</button>
        <button onclick="selectPoli('mata')">Poli Mata</button>
      </div>
    </div>

    <!-- Current Queue Control -->
    <div class="queue-control-panel">
      <h3 style="color: #fff; margin-bottom: 1.5rem;">ğŸ¯ Kontrol Antrean Aktif - <span id="poliName">Poli Umum</span></h3>
      
      <div class="current-patient-card" id="currentPatientCard">
        <div style="display: flex; justify-content: space-between; align-items: start; gap: 2rem;">
          <div style="flex: 1;">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
              <span style="font-size: 3rem; font-weight: bold; color: #00796b;">A-009</span>
              <span class="badge badge-success" style="font-size: 1rem;">Sedang Dilayani</span>
            </div>
            <h3 style="margin: 0.5rem 0; color: #333;">Budi Santoso</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem; margin-top: 1rem; color: #666;">
              <p><strong>NIK:</strong> 3201012345678902</p>
              <p><strong>Umur:</strong> 45 tahun</p>
              <p><strong>Jenis Pembayaran:</strong> BPJS</p>
              <p><strong>No. RM:</strong> RM-2024-001234</p>
            </div>
            <div style="margin-top: 1rem; padding: 1rem; background: #f5f5f5; border-radius: 8px;">
              <p style="margin: 0; color: #666;"><strong>Keluhan Utama:</strong></p>
              <p style="margin: 0.5rem 0 0 0;">Batuk dan pilek 3 hari, demam ringan, sakit tenggorokan</p>
            </div>
            <div style="margin-top: 1rem; display: flex; gap: 1rem; color: #666;">
              <p>â° Masuk Ruangan: <strong>09:58 WIB</strong></p>
              <p>â±ï¸ Durasi: <strong><span id="duration">12 menit</span></strong></p>
            </div>
          </div>
          <div style="min-width: 150px;">
            <div style="text-align: center; padding: 1rem; background: #e8f5e9; border-radius: 8px; margin-bottom: 1rem;">
              <p style="margin: 0; color: #666; font-size: 0.9rem;">Dokter</p>
              <p style="margin: 0.5rem 0 0 0; font-weight: 600; color: #00796b;">dr. Ahmad Fauzi</p>
            </div>
            <div style="text-align: center; padding: 1rem; background: #fff3cd; border-radius: 8px;">
              <p style="margin: 0; color: #666; font-size: 0.9rem;">Ruang</p>
              <p style="margin: 0.5rem 0 0 0; font-weight: 600; color: #f57c00;">Ruang 1</p>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="refreshData()">ğŸ”„ Refresh Data</button>
          <button class="btn btn-success" onclick="window.location.href='hasil-pemeriksaan.html?nomor=A-009'">ğŸ“ Catat Hasil</button>
          <button class="btn btn-warning" onclick="tundaPasien()">â¸ï¸ Tunda Pelayanan</button>
          <button class="btn btn-secondary" onclick="selesaiPelayanan()">âœ… Selesai & Panggil Berikutnya</button>
        </div>
      </div>

      <!-- Next Queue Preview -->
      <div style="margin-top: 2rem;">
        <h4 style="color: #fff; margin-bottom: 1rem;">ğŸ“‹ Antrean Selanjutnya</h4>
        <div class="next-queue">
          <div class="next-queue-item" onclick="panggilPasien('A-010')">
            <p style="font-size: 2rem; font-weight: bold; margin: 0.5rem 0;">A-010</p>
            <p style="margin: 0; font-size: 0.9rem;">Siti Aminah</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem; opacity: 0.9;">09:50 WIB</p>
          </div>
          <div class="next-queue-item" onclick="panggilPasien('A-011')">
            <p style="font-size: 2rem; font-weight: bold; margin: 0.5rem 0;">A-011</p>
            <p style="margin: 0; font-size: 0.9rem;">Dewi Lestari</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem; opacity: 0.9;">09:52 WIB</p>
          </div>
          <div class="next-queue-item" onclick="panggilPasien('A-012')">
            <p style="font-size: 2rem; font-weight: bold; margin: 0.5rem 0;">A-012</p>
            <p style="margin: 0; font-size: 0.9rem;">Ahmad Ridwan</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem; opacity: 0.9;">09:30 WIB</p>
          </div>
          <div class="next-queue-item">
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">+9</p>
            <p style="margin: 0; font-size: 0.9rem;">Pasien Lainnya</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem; opacity: 0.9;">Menunggu</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Status Timeline -->
    <div class="card">
      <h3>ğŸ“Š Timeline Status Antrean</h3>
      <p style="color: #666; margin-bottom: 2rem;">Ubah status antrean pasien secara manual</p>
      
      <div class="status-timeline">
        <div class="status-step completed">
          <div class="status-step-circle">1</div>
          <p style="font-size: 0.9rem; font-weight: 600;">Terdaftar</p>
          <p style="font-size: 0.8rem; color: #666;">09:45 WIB</p>
        </div>
        <div class="status-step completed">
          <div class="status-step-circle">2</div>
          <p style="font-size: 0.9rem; font-weight: 600;">Dipanggil</p>
          <p style="font-size: 0.8rem; color: #666;">09:57 WIB</p>
        </div>
        <div class="status-step active">
          <div class="status-step-circle">3</div>
          <p style="font-size: 0.9rem; font-weight: 600;">Dilayani</p>
          <p style="font-size: 0.8rem; color: #666;">09:58 WIB</p>
        </div>
        <div class="status-step">
          <div class="status-step-circle">4</div>
          <p style="font-size: 0.9rem; font-weight: 600;">Selesai</p>
          <p style="font-size: 0.8rem; color: #666;">-</p>
        </div>
      </div>

      <div style="margin-top: 2rem; padding: 1.5rem; background: #f5f5f5; border-radius: 8px;">
        <h4>âš™ï¸ Ubah Status Manual</h4>
        <div class="form-row" style="margin-top: 1rem;">
          <div class="form-group">
            <label for="manualQueueNo">Nomor Antrean</label>
            <input type="text" id="manualQueueNo" placeholder="A-XXX" value="A-009">
          </div>
          <div class="form-group">
            <label for="manualStatus">Status Baru</label>
            <select id="manualStatus">
              <option value="menunggu">Menunggu</option>
              <option value="dipanggil">Dipanggil</option>
              <option value="dilayani" selected>Sedang Dilayani</option>
              <option value="selesai">Selesai</option>
              <option value="tidak-hadir">Tidak Hadir</option>
              <option value="batal">Dibatalkan</option>
            </select>
          </div>
          <div class="form-group">
            <label for="manualNote">Catatan</label>
            <input type="text" id="manualNote" placeholder="Catatan tambahan (opsional)">
          </div>
          <div class="form-group">
            <label>&nbsp;</label>
            <button class="btn btn-primary" onclick="updateStatus()">ğŸ’¾ Update Status</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="stats-grid">
      <div class="card">
        <h3>ğŸ“¢ Panggil Pasien</h3>
        <p style="margin: 1rem 0; color: #666;">Panggil nomor antrean tertentu</p>
        <div class="form-group">
          <input type="text" id="callQueueNo" placeholder="Nomor antrean (A-XXX)">
        </div>
        <button class="btn btn-primary" onclick="callSpecific()">ğŸ“¢ Panggil</button>
      </div>

      <div class="card">
        <h3>â© Lewati Antrean</h3>
        <p style="margin: 1rem 0; color: #666;">Tandai pasien tidak hadir</p>
        <div class="form-group">
          <input type="text" id="skipQueueNo" placeholder="Nomor antrean (A-XXX)">
        </div>
        <button class="btn btn-warning" onclick="skipQueue()">â© Lewati</button>
      </div>

      <div class="card">
        <h3>ğŸ”„ Reset Antrean</h3>
        <p style="margin: 1rem 0; color: #666;">Reset semua status antrean hari ini</p>
        <p style="margin: 1rem 0; font-size: 0.9rem; color: #d32f2f;"><strong>âš ï¸ Peringatan:</strong> Aksi ini tidak bisa dibatalkan</p>
        <button class="btn btn-danger" onclick="resetAllQueue()">ğŸ”„ Reset Semua</button>
      </div>

      <div class="card">
        <h3>ğŸ“Š Statistik Hari Ini</h3>
        <div style="margin: 1rem 0;">
          <p><strong>Total:</strong> 45 pasien</p>
          <p><strong>Selesai:</strong> 32 pasien</p>
          <p><strong>Rata-rata durasi:</strong> 8 menit</p>
        </div>
        <button class="btn btn-secondary" onclick="window.location.href='daftar-antrean.html'">ğŸ“‹ Lihat Detail</button>
      </div>
    </div>

    <!-- History Log -->
    <div class="card">
      <h3>ğŸ“œ Log Aktivitas Antrean (5 Terakhir)</h3>
      <table>
        <thead>
          <tr>
            <th>Waktu</th>
            <th>No. Antrean</th>
            <th>Pasien</th>
            <th>Aksi</th>
            <th>Status</th>
            <th>Petugas</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>09:58</td>
            <td><strong>A-009</strong></td>
            <td>Budi Santoso</td>
            <td><span class="badge badge-success">Mulai Dilayani</span></td>
            <td>Menunggu â†’ Dilayani</td>
            <td>Sri Wahyuni</td>
          </tr>
          <tr>
            <td>09:57</td>
            <td><strong>A-009</strong></td>
            <td>Budi Santoso</td>
            <td><span class="badge badge-info">Dipanggil</span></td>
            <td>Menunggu â†’ Dipanggil</td>
            <td>Sri Wahyuni</td>
          </tr>
          <tr>
            <td>09:50</td>
            <td><strong>A-008</strong></td>
            <td>Ratna Sari</td>
            <td><span class="badge badge-secondary">Selesai</span></td>
            <td>Dilayani â†’ Selesai</td>
            <td>Sri Wahyuni</td>
          </tr>
          <tr>
            <td>09:45</td>
            <td><strong>A-008</strong></td>
            <td>Ratna Sari</td>
            <td><span class="badge badge-success">Mulai Dilayani</span></td>
            <td>Dipanggil â†’ Dilayani</td>
            <td>Sri Wahyuni</td>
          </tr>
          <tr>
            <td>09:43</td>
            <td><strong>A-008</strong></td>
            <td>Ratna Sari</td>
            <td><span class="badge badge-info">Dipanggil</span></td>
            <td>Menunggu â†’ Dipanggil</td>
            <td>Sri Wahyuni</td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-secondary" style="margin-top: 1rem; width: 100%;">Lihat Semua Log</button>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Smart Health Center Service. All Rights Reserved.</p>
  </footer>

  <script>
    // Update current time
    function updateTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
      document.getElementById('currentTime').textContent = timeString + ' WIB';
    }
    updateTime();
    setInterval(updateTime, 60000);

    // Update duration
    let durationMinutes = 12;
    setInterval(() => {
      durationMinutes++;
      document.getElementById('duration').textContent = durationMinutes + ' menit';
    }, 60000);

    function selectPoli(poli) {
      const buttons = document.querySelectorAll('.poli-selector button');
      buttons.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      const poliNames = {
        'umum': 'Poli Umum',
        'gigi': 'Poli Gigi',
        'anak': 'Poli Anak',
        'kandungan': 'Poli Kandungan',
        'mata': 'Poli Mata'
      };
      
      document.getElementById('poliName').textContent = poliNames[poli];
      alert('ğŸ“‹ Memuat data antrean ' + poliNames[poli] + '...');
    }

    function refreshData() {
      alert('ğŸ”„ Memuat ulang data antrean...');
      location.reload();
    }

    function selesaiPelayanan() {
      if (confirm('âœ… Tandai pelayanan A-009 selesai?\n\nSistem akan otomatis memanggil pasien berikutnya (A-010).')) {
        alert('âœ… Pelayanan selesai!\nğŸ“¢ Pasien A-010 (Siti Aminah) telah dipanggil.');
        location.reload();
      }
    }

    function tundaPasien() {
      if (confirm('â¸ï¸ Tunda pelayanan A-009?\n\nPasien akan dikembalikan ke daftar antrean.')) {
        alert('â¸ï¸ Pasien A-009 ditunda.\nMemanggil pasien A-010...');
        location.reload();
      }
    }

    function panggilPasien(nomor) {
      if (confirm('ğŸ“¢ Panggil pasien ' + nomor + '?\n\nPasien saat ini (A-009) akan ditunda otomatis.')) {
        alert('ğŸ“¢ Pasien ' + nomor + ' dipanggil!\n\nPasien A-009 dikembalikan ke antrean.');
        location.reload();
      }
    }

    function updateStatus() {
      const queueNo = document.getElementById('manualQueueNo').value;
      const status = document.getElementById('manualStatus').value;
      const note = document.getElementById('manualNote').value;
      
      if (!queueNo) {
        alert('âŒ Nomor antrean harus diisi!');
        return;
      }
      
      const statusNames = {
        'menunggu': 'Menunggu',
        'dipanggil': 'Dipanggil',
        'dilayani': 'Sedang Dilayani',
        'selesai': 'Selesai',
        'tidak-hadir': 'Tidak Hadir',
        'batal': 'Dibatalkan'
      };
      
      if (confirm('Ubah status ' + queueNo + ' menjadi "' + statusNames[status] + '"?' + 
                  (note ? '\n\nCatatan: ' + note : ''))) {
        alert('âœ… Status ' + queueNo + ' berhasil diubah menjadi "' + statusNames[status] + '"!');
        location.reload();
      }
    }

    function callSpecific() {
      const queueNo = document.getElementById('callQueueNo').value;
      if (!queueNo) {
        alert('âŒ Nomor antrean harus diisi!');
        return;
      }
      if (confirm('ğŸ“¢ Panggil pasien ' + queueNo + '?')) {
        alert('ğŸ“¢ Pasien ' + queueNo + ' dipanggil!');
        location.reload();
      }
    }

    function skipQueue() {
      const queueNo = document.getElementById('skipQueueNo').value;
      if (!queueNo) {
        alert('âŒ Nomor antrean harus diisi!');
        return;
      }
      if (confirm('â© Tandai pasien ' + queueNo + ' tidak hadir?')) {
        alert('â© Pasien ' + queueNo + ' ditandai tidak hadir.');
        location.reload();
      }
    }

    function resetAllQueue() {
      if (confirm('âš ï¸ PERINGATAN!\n\nAnda akan mereset semua status antrean hari ini.\nAksi ini TIDAK BISA dibatalkan!\n\nLanjutkan?')) {
        if (confirm('Apakah Anda YAKIN?\n\nSemua antrean akan dikembalikan ke status awal.')) {
          alert('ğŸ”„ Semua antrean telah direset!');
          location.reload();
        }
      }
    }

    // Auto refresh every 30 seconds
    setInterval(() => {
      console.log('Checking for updates...');
    }, 30000);
  </script>
</body>
</html>
